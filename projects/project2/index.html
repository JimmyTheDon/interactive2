<title>Wireframe 2</title>
<link rel="stylesheet" href="styles.css">
<script src="processing.js"></script>
<script type="text/processing" data-processing-target="mycanvas">

ArrayList<MovingNode> nodes;
float maxDistance = 50;
float dx = 10;
float dy = 10;
float maxNeighbors = 2.5;
 
Boolean drawMode = true;
 
void setup()
{
  size(1428,1600);
  background(255);
  nodes = new ArrayList<MovingNode>();
}
 
void draw()
{
  addNewNode(width*0.25,height*0.25,random(-dx,dx),random(-dx,dx));
  addNewNode(width/2,height/2,random(-dx,dx),random(-dx,dx));
  addNewNode(width*0.75,height*0.75,random(-dx,dx),random(-dx,dx));
  addNewNode(random(0,1428),random(0,1600),random(-dx,dx),random(-dx,dx));
  addNewNode(random(0,1428),random(0,1600),random(-dx,dx),random(-dx,dx));
  addNewNode(random(0,1428),random(0,1600),random(-dx,dx),random(-dx,dx));
  addNewNode(random(0,1428),random(0,1600),random(-dx,dx),random(-dx,dx));
  addNewNode(random(0,1428),random(0,1600),random(-dx,dx),random(-dx,dx));



  background(255);
   
  for(int i=0; i<nodes.size(); i++)
  {
    MovingNode currentNode = nodes.get(i);
    currentNode.setNumNeighbors( countNumNeighbors(currentNode,maxDistance) );
  }
   
  for(int i = 0; i < nodes.size(); i++){
    MovingNode currentNode = nodes.get(i);
    for(int j=0; j<currentNode.neighbors.size(); j++)
    {
      MovingNode neighborNode = currentNode.neighbors.get(j);
      stroke(random(0,255), random(0,255), random(0,255), random(0,255));
      line(currentNode.x,currentNode.y,neighborNode.x,neighborNode.y);
    }
    currentNode.display();
  }
   
   
   
}
 
void addNewNode(float xPos, float yPos, float dx, float dy)
{
  MovingNode node = new MovingNode(xPos+dx,yPos+dy);
   
  node.setNumNeighbors( countNumNeighbors(node,maxDistance) );
   
   if(node.numNeighbors < maxNeighbors){
    nodes.add(node);
    /*for(int i=0; i<nodes.size(); i++)
    {
      MovingNode currentNode = nodes.get(i);
      currentNode.setNumNeighbors( countNumNeighbors(currentNode,maxDistance) );
    }*/
  }
   
   
}
 
int countNumNeighbors(MovingNode nodeA, float maxNeighborDistance)
{
  int numNeighbors = 0;
  nodeA.clearNeighbors();
   
  for(int i = 0; i < nodes.size(); i++)
  {
    MovingNode nodeB = nodes.get(i);
    float distance = sqrt((nodeA.x-nodeB.x)*(nodeA.x-nodeB.x) + (nodeA.y-nodeB.y)*(nodeA.y-nodeB.y));
    if(distance < maxNeighborDistance)
    {
      numNeighbors++;
      nodeA.addNeighbor(nodeB);
    }
  }
  return numNeighbors;
}
 
void keyPressed()
{
  drawMode = !drawMode;
  nodes = new ArrayList<MovingNode>();
}
class MovingNode
{
  float x;
  float y;
  int numNeighbors;
  ArrayList<MovingNode> neighbors;
  float lineColor;
  float nodeWidth = 3;
  float nodeHeight = 3;
  float fillColor = 0;
  float lineColorRange = 180;
   
  int lifetime = 200;
   
  float xVel=0;
  float yVel=0;
  float xAccel=0;
  float yAccel=0;
   
  float accelValue = 0.5;
 
  MovingNode(float xPos, float yPos)
  {
    x = xPos;
    y = yPos;
    numNeighbors = 0;
    neighbors = new ArrayList<MovingNode>();
  }
   
  void display()
  {
    move();
     
    noStroke();
    fill(fillColor);
    ellipse(x,y,nodeWidth,nodeHeight);
  }
   
  void move()
  {
    xAccel = random(-accelValue,accelValue);
    yAccel = random(-accelValue,accelValue);
     
    xVel += xAccel;
    yVel += yAccel;
     
    if(x < 0)
    {
      x = 0;
      xVel *= -1;
     
    } else if(x > width)
    {
      x = width;
      xVel *= -1;
    }
     
    if(y < 0)
    {
      y = 0;
      yVel *= -1;
     
    } else if(y > height)
    {
      y = height;
      yVel *= -1;
    }
     
    x += xVel;
    y += yVel;
     
    lifetime--;
    if (lifetime == 0)
    {
      nodes.remove(this);
    }
  }
   
  void addNeighbor(MovingNode node)
  {
    neighbors.add(node);
  }
   
  void setNumNeighbors(int num)
  {
    numNeighbors = num;
  }
   
  void clearNeighbors()
  {
    neighbors = new ArrayList<MovingNode>();
  }
   
  float calculateLineColor(Node neighborNode, float maxDistance)
  {
    float distance = sqrt((x-neighborNode.x)*(x-neighborNode.x) + (y-neighborNode.y)*(y-neighborNode.y));
    lineColor = (distance/maxDistance)*lineColorRange;
    return 255; //(127 + (255 - lineColor));
  }
     
}
class Node
{
  float x;
  float y;
  int numNeighbors;
  ArrayList<Node> neighbors;
  float lineColor;
  float nodeWidth = 3;
  float nodeHeight = 3;
  float fillColor = 50;
  float lineColorRange = 160;
 
  Node(float xPos, float yPos)
  {
    x = xPos;
    y = yPos;
    numNeighbors = 0;
    neighbors = new ArrayList<Node>();
  }
   
  void display()
  {
    noStroke();
    fill(fillColor);
    ellipse(x,y,nodeWidth,nodeHeight);
  }
   
  void addNeighbor(Node node)
  {
    neighbors.add(node);
  }
   
  void setNumNeighbors(int num)
  {
    numNeighbors = num;
  }
   
  void clearNeighbors()
  {
    neighbors = new ArrayList<Node>();
  }
   
  float calculateLineColor(Node neighborNode, float maxDistance)
  {
    float distance = sqrt((x-neighborNode.x)*(x-neighborNode.x) + (y-neighborNode.y)*(y-neighborNode.y));
    lineColor = (distance/maxDistance)*lineColorRange;
    return 255; //(127 + (255 - lineColor));
  }
     
}
</script>
<canvas id="mycanvas"></canvas>
<img id="img" src="img/wireframe2.png">